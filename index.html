<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <!-- <link rel="stylesheet" href="main.css"> -->
    <title>VR Maze</title>
    <meta name="description" content="Now in 3D!">

    <script src="https://aframe.io/releases/0.3.2/aframe.js"></script>
    <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v2.6.1/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.1.0/dist/aframe-environment-component.min.js"></script>
    <script src="js/map.js"></script>

  
  </head>
  <body>
    
    <a-scene > 
      <!-- environment="preset:forest"  -->
      <!-- fog="type: linear; color: lightgrey; far: 16; near: 7" -->

      <a-assets>
        <img id="floor" src="img/floor.jpg">
        <img id="wall" src="img/wall.jpg">
      </a-assets>
      
      <a-entity 
        id="player"
        camera
        universal-controls
        kinematic-body>
      </a-entity>
    
      <a-grid
        id="ground" 
        static-body>
      </a-grid>
      
      <a-entity id="walls"></a-entity>
      
      <a-sky id="sky" color="skyblue"></a-sky>
      
      <a-light type="ambient" color="#ccc"></a-light>


     
    </a-scene>

    <script>

      document.querySelector('a-scene').addEventListener('render-target-loaded', () => {
        const WALL_SIZE = 3;
        const WALL_HEIGHT = 12;
        const el = document.querySelector('#walls');
        let playerPos;

        for (let x = 0; x < map.height; x++) {
          for (let y = 0; y < map.width; y++) {

            const i = (y * map.width) + x;
            const position = 
              `${((x - (map.width / 2)) * WALL_SIZE)} 1.5 ${(y - (map.height / 2)) * WALL_SIZE}`;

            console.log([x,y,i]);


      //>>>>>>>>>>>>>> IF MAP.DATA[I] == 1, CREATE A WALL <<<<<<<<<<<<<<<<
            if (map.data[i] === 1) {
              console.log(position);
              let wall = document.createElement('a-box');
              el.appendChild(wall);

              wall.setAttribute('width', WALL_SIZE);
              wall.setAttribute('height', WALL_HEIGHT);
              wall.setAttribute('depth', WALL_SIZE);
              wall.setAttribute('color', '#fff');
              wall.setAttribute('material', 'src: #wall');
              wall.setAttribute('position', position);
              wall.setAttribute('static-body', '');
            }

            // >>>>>>>>>>>>>> PLAYER POSITION <<<<<<<<<<<<<<<<
            if (map.data[i] === 2) {
              playerPos = position;
            } 
            if (map.data[i] === 3) {
              console.log(position);
            }
          }
        }
        document.querySelector('#player').setAttribute('position', playerPos);
      });

    </script>

    <!-- ====== JS SCRIPTS ====== -->
    <script src="js/index.js"></script>
    
    
  </body>
</html>